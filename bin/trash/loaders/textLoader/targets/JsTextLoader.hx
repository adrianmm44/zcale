/////////////////////////////////////////////////////////////////////////////////////////////////////////

package hxf.core.loaders.textLoader.targets;

import hxf.core.tools.ClientTools;
import hxf.core.events.dispatchers.TextDispatcher;

class JsTextLoader extends TextDispatcher
{
	/////////////////////////////////////////////////////////////////////////////////////////////////////
	
	private var filePath : String;
	
	/////////////////////////////////////////////////////////////////////////////////////////////////////
	
	public function new( sub : Dynamic )
	{
		super( sub );
	}
	
	/////////////////////////////////////////////////////////////////////////////////////////////////////
	
	public function load( filePath : String ) : Void
	{
		this.filePath = filePath;
		
		ClientTools.httpRequest( filePath, false, onLoadComplete, onLoadError );
	}
	
	/////////////////////////////////////////////////////////////////////////////////////////////////////
	
	private function onLoadComplete( data : String ) : Void 
	{
		eventData().text = data;
		
		dispatchEvent( eventType().complete );
	}
		
	/////////////////////////////////////////////////////////////////////////////////////////////////////
	
	private function onLoadError( errorMessage : Dynamic ) : Void
	{
		dispatchError( eventData().error, this, "load", "File not found: " + filePath );
	}
	
	/////////////////////////////////////////////////////////////////////////////////////////////////////
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////