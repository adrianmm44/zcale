/////////////////////////////////////////////////////////////////////////////////////////////////////////

package hxf.core.loaders.textLoader.targets;

import flash.events.Event;
import flash.events.IOErrorEvent;
import flash.net.URLLoader;
import flash.net.URLRequest;
import hxf.core.events.dispatchers.TextDispatcher;

class FlashTextLoader extends TextDispatcher
{
	/////////////////////////////////////////////////////////////////////////////////////////////////////
	
	private var filePath : String;
	
	/////////////////////////////////////////////////////////////////////////////////////////////////////
	
	public function new( sub : Dynamic )
	{
		super( sub );
	}
	
	/////////////////////////////////////////////////////////////////////////////////////////////////////
	
	public function load( filePath : String ) : Void
	{		
		this.filePath = filePath;
		
		var loader 	  = new URLLoader();
		loader.addEventListener( Event.COMPLETE, 		onLoadComplete );
		loader.addEventListener( IOErrorEvent.IO_ERROR, onLoadError    );
		loader.load( new URLRequest( filePath ) );
	}
				
	/////////////////////////////////////////////////////////////////////////////////////////////////////
	
	private function onLoadComplete( event : Event ) : Void 
	{
		eventData().text = event.target.data;
						
		dispatchEvent( eventType().complete );
	}
		
	/////////////////////////////////////////////////////////////////////////////////////////////////////
		
	private function onLoadError( event : IOErrorEvent ) : Void
	{
		dispatchError( eventData().error, this, "load", event.text + " File not found: " + filePath );
	}
	
	/////////////////////////////////////////////////////////////////////////////////////////////////////
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////