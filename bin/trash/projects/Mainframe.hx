////////////////////////////////////////////////////////////////////////////////////////////////////////

package ;

import hxf.Core;
import hxf.core.Boot;
import hxf.core.Registry;
import hxf.core.tools.ClassTools;
import hxf.core.tester.CoreLibTester;

class Mainframe
{
	/////////////////////////////////////////////////////////////////////////////////////////////////////
	
	private var core : Core;
	
	/////////////////////////////////////////////////////////////////////////////////////////////////////
	
	public static function main() : Void
	{		
		new Mainframe();
	}
	
	/////////////////////////////////////////////////////////////////////////////////////////////////////
	
	public function new()
	{	
		core = new Core();
		core.addEventListener( core.eventType().complete, onBootComplete );
		core.addEventListener( core.eventType().error, 	  onError );
		core.boot();
	}
	
	/////////////////////////////////////////////////////////////////////////////////////////////////////
		
	private function onBootComplete( core : Core ) : Void
	{
		Core.trace( ClassTools.getLocalClass() + " booting completed" + "\n" );
		
		testCoreLib();
	}
	
	/////////////////////////////////////////////////////////////////////////////////////////////////////
	
	public function testCoreLib() : Void
	{
		var tester = new CoreLibTester( core.registry );
		tester.addEventListener( tester.eventType().complete, onTestComplete );
		tester.addEventListener( tester.eventType().error, 	  onError );
		tester.test( false );
	}
	
	private function onTestComplete( tester : CoreLibTester ) : Void
	{
		Core.trace( tester.eventData().testResults  );
		
		Core.trace("End of program");
	}
	
	/////////////////////////////////////////////////////////////////////////////////////////////////////
	
	private function onError( cls : Dynamic ) : Void
	{		
		Core.trace( cls.eventData().error.toString() );
	}
	
	/////////////////////////////////////////////////////////////////////////////////////////////////////
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////